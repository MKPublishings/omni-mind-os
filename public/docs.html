<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Omni Mind/OS â€“ Documentation</title>
  <link rel="stylesheet" href="/styles/base.css" />
  <link rel="stylesheet" href="/styles/layout.css" />
  <link rel="stylesheet" href="/styles/components.css" />
  <link rel="stylesheet" href="/styles/docs.css" />
</head>
<body class="page">
  <div id="layout">
    <aside id="sidebar">
      <h1 class="logo">Omni Mind/OS</h1>

      <nav class="nav">
        <a href="/index.html" class="nav-link">Home</a>
        <a href="/chat.html" class="nav-link">Chat</a>
        <a href="/docs.html" class="nav-link active">Docs</a>
        <a href="/modes.html" class="nav-link">Modes</a>
        <a href="/settings.html" class="nav-link">Settings</a>
        <a href="/about.html" class="nav-link">About</a>
      </nav>

      <div class="sidebar-footer">
        <span class="status-dot"></span>
        <span class="status-text">System: Online</span>
      </div>
    </aside>

    <main id="main" class="docs-main">
      <header class="page-header">
        <h2>Documentation</h2>
        <p class="page-subtitle">Technical reference for Omni Mind/OS architecture, modes, memory systems, and API integration.</p>
      </header>

      <div class="docs-hub-grid">
        <a href="/docs-overview.html" class="docs-hub-card">
          <div class="docs-hub-icon">ğŸ“˜</div>
          <h3>Overview</h3>
          <p>Core philosophy, technology stack, and project structure</p>
          <span class="docs-hub-arrow">â†’</span>
        </a>

        <a href="/docs-architecture.html" class="docs-hub-card">
          <div class="docs-hub-icon">ğŸ—ï¸</div>
          <h3>Architecture</h3>
          <p>System design, request flow, and data storage</p>
          <span class="docs-hub-arrow">â†’</span>
        </a>

        <a href="/docs-modes.html" class="docs-hub-card">
          <div class="docs-hub-icon">ğŸ§ </div>
          <h3>Modes</h3>
          <p>Cognitive primitives and mode selection logic</p>
          <span class="docs-hub-arrow">â†’</span>
        </a>

        <a href="/docs-memory.html" class="docs-hub-card">
          <div class="docs-hub-icon">ğŸ’¾</div>
          <h3>Memory</h3>
          <p>Persistent context and session management</p>
          <span class="docs-hub-arrow">â†’</span>
        </a>

        <a href="/docs-api.html" class="docs-hub-card">
          <div class="docs-hub-icon">âš¡</div>
          <h3>API Reference</h3>
          <p>Endpoints, streaming, and integration examples</p>
          <span class="docs-hub-arrow">â†’</span>
        </a>
      </div>

      <div class="docs-footer">
        <div class="quick-links">
          <h3>Quick Links</h3>
          <div class="quick-links-grid">
            <a href="/chat.html" class="quick-link">
              <span>ğŸ’¬</span>
              Try Chat Interface
            </a>
            <a href="/modes.html" class="quick-link">
              <span>ğŸ”®</span>
              Explore Modes
            </a>
            <a href="/settings.html" class="quick-link">
              <span>âš™ï¸</span>
              Configure Settings
            </a>
          </div>
        </div>
      </div>
    </main>
  </div>

  <script>
(() => {
  const body = document.body;
  if (!body) return;

  let navigating = false;

  document.addEventListener("click", (e) => {
    const link = e.target.closest("a.nav-link");
    if (!link) return;

    const href = link.getAttribute("href");
    if (!href || href.startsWith("#")) return;
    if (link.target === "_blank" || link.hasAttribute("download")) return;
    if (e.metaKey || e.ctrlKey || e.shiftKey || e.altKey) return;

    const url = new URL(link.href, window.location.href);
    if (url.origin !== window.location.origin) return;

    e.preventDefault();
    if (navigating) return;
    navigating = true;

    body.classList.add("page-transition");

    const ms =
      parseFloat(getComputedStyle(body).getPropertyValue("--page-transition-ms")) || 350;

    window.setTimeout(() => {
      window.location.assign(url.href);
    }, ms);
  });
})();
</script>
</body>
</html>
            <ol class="numbered-steps">
              <li>
                <strong>Client Request</strong>
                <p>User submits message via chat interface. JavaScript captures input and initiates SSE connection to <code>/api/omni/stream</code>.</p>
              </li>
              <li>
                <strong>Worker Routing</strong>
                <p>Cloudflare Worker receives POST request, extracts message/mode/model, validates input, and loads session context from KV.</p>
              </li>
              <li>
                <strong>Mode Selection</strong>
                <p>If automatic mode, AI heuristics analyze message intent. If manual, uses user-selected mode. Loads corresponding cognitive primer.</p>
              </li>
              <li>
                <strong>Memory Retrieval</strong>
                <p>Queries MEMORY namespace for relevant facts, preferences, and contextual data. Injects into system prompt.</p>
              </li>
              <li>
                <strong>Emotion Checkpoint</strong>
                <p>Analyzes conversation state, detects emotional tone, modulates response parameters (temperature, length, formality).</p>
              </li>
              <li>
                <strong>AI Inference</strong>
                <p>Streams tokens from Workers AI via model router. Supports fallback chains (primary â†’ backup model).</p>
              </li>
              <li>
                <strong>Response Processing</strong>
                <p>Validates output, applies safety guards, chunks into SSE events, streams to client with <code>data:</code> prefix.</p>
              </li>
              <li>
                <strong>Memory Update</strong>
                <p>Extracts learnings from response, updates KV storage with new facts/preferences asynchronously.</p>
              </li>
            </ol>

            <h3>Data Storage</h3>
            <div class="data-table">
              <table>
                <thead>
                  <tr>
                    <th>Namespace</th>
                    <th>Purpose</th>
                    <th>Key Format</th>
                    <th>TTL</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td><code>MEMORY</code></td>
                    <td>User facts, preferences</td>
                    <td><code>user:facts</code></td>
                    <td>Persistent</td>
                  </tr>
                  <tr>
                    <td><code>MIND</code></td>
                    <td>System state, codex</td>
                    <td><code>codex:entry</code></td>
                    <td>Persistent</td>
                  </tr>
                  <tr>
                    <td><code>localStorage</code></td>
                    <td>Session history, settings</td>
                    <td><code>omni-chat-history</code></td>
                    <td>Client-side</td>
                  </tr>
                </tbody>
              </table>
            </div>

            <h3>Security & Performance</h3>
            <div class="two-column-grid">
              <div>
                <h4>Security Measures</h4>
                <ul>
                  <li>Input sanitization via <code>OmniSafety</code></li>
                  <li>50,000 character response caps</li>
                  <li>Rate limiting (future: per-IP throttling)</li>
                  <li>No PII in KV storage</li>
                  <li>HTTPS-only connections</li>
                </ul>
              </div>
              <div>
                <h4>Performance Optimizations</h4>
                <ul>
                  <li>Edge compute (< 50ms latency)</li>
                  <li>Streaming SSE (zero buffer delay)</li>
                  <li>KV caching (global replication)</li>
                  <li>Adaptive token budgeting</li>
                  <li>Lazy module loading</li>
                </ul>
              </div>
            </div>
          </section>

          <!-- SECTION: MODES -->
          <section id="modes" class="doc-section">
            <h2 class="section-title">Modes</h2>

            <div class="doc-intro">
              <p class="lead">Modes are <strong>cognitive primers</strong> that reshape the AI's reasoning patterns, language style, and problem-solving approach. Each mode is optimized for specific domains.</p>
            </div>

            <div class="warning-box">
              <div class="warning-icon">âš ï¸</div>
              <div>
                <strong>Mode Switching</strong>
                <p>Mode changes take effect on the next message. Previous context is preserved but interpreted through the new cognitive lens.</p>
              </div>
            </div>

            <h3>Available Modes</h3>

            <div class="mode-doc-card">
              <div class="mode-doc-header">
                <span class="mode-doc-icon">ğŸ—ï¸</span>
                <h4>Architect</h4>
                <span class="mode-doc-badge">Default</span>
              </div>
              <p><strong>Focus:</strong> System design, modularity, technical precision</p>
              <p><strong>Reasoning:</strong> Top-down decomposition, structured hierarchies</p>
              <p><strong>Language:</strong> Concise, technical, diagram-friendly</p>
              <p><strong>Best For:</strong> Code architecture, API design, system planning</p>
              <div class="code-block">
                <strong>Primer Excerpt:</strong>
                <pre><code>You think in systems, structures, pipelines, and clarity.
You break down complexity into elegant, modular components.
You avoid fluff and focus on precision.</code></pre>
              </div>
            </div>

            <div class="mode-doc-card">
              <div class="mode-doc-header">
                <span class="mode-doc-icon">ğŸ“Š</span>
                <h4>Analyst</h4>
              </div>
              <p><strong>Focus:</strong> Data interpretation, logical reasoning, insights</p>
              <p><strong>Reasoning:</strong> Deductive and inductive logic, pattern recognition</p>
              <p><strong>Language:</strong> Analytical, explanatory, evidence-based</p>
              <p><strong>Best For:</strong> Research synthesis, data analysis, reports</p>
              <div class="code-block">
                <strong>Primer Excerpt:</strong>
                <pre><code>You break down ideas with clarity, logic, and structured reasoning.
You explain, simplify, and reveal hidden patterns.</code></pre>
              </div>
            </div>

            <div class="mode-doc-card">
              <div class="mode-doc-header">
                <span class="mode-doc-icon">ğŸ¨</span>
                <h4>Visual</h4>
              </div>
              <p><strong>Focus:</strong> Composition, atmosphere, sensory immersion</p>
              <p><strong>Reasoning:</strong> Spatial and aesthetic, cinematic framing</p>
              <p><strong>Language:</strong> Evocative, descriptive, scene-building</p>
              <p><strong>Best For:</strong> UI/UX design, creative direction, storytelling</p>
              <div class="code-block">
                <strong>Primer Excerpt:</strong>
                <pre><code>You think in images, cinematography, color, texture, and atmosphere.
Your language evokes scenes, lighting, and motion.</code></pre>
              </div>
            </div>

            <div class="mode-doc-card">
              <div class="mode-doc-header">
                <span class="mode-doc-icon">ğŸ“–</span>
                <h4>Lore</h4>
              </div>
              <p><strong>Focus:</strong> Worldbuilding, narrative depth, emotional resonance</p>
              <p><strong>Reasoning:</strong> Thematic and mythic, character-driven</p>
              <p><strong>Language:</strong> Poetic, symbolic, emotionally charged</p>
              <p><strong>Best For:</strong> Game narratives, fiction writing, mythology</p>
              <div class="code-block">
                <strong>Primer Excerpt:</strong>
                <pre><code>You speak in mythic resonance, symbolic language, and narrative arcs.
You weave meaning into every sentence.
You create worlds, histories, and emotional gravity.</code></pre>
              </div>
            </div>

            <h3>Mode Selection Logic</h3>
            <p>When <strong>automatic mode</strong> is enabled, the system uses heuristic analysis:</p>
            <div class="code-block">
              <pre><code>// Simplified mode detection logic
if (message.includes("design") || message.includes("architecture")) {
  return "architect";
} else if (message.includes("data") || message.includes("analyze")) {
  return "analyst";
} else if (message.includes("scene") || message.includes("visual")) {
  return "visual";
} else if (message.includes("story") || message.includes("world")) {
  return "lore";
}
return "architect"; // default</code></pre>
            </div>
          </section>

          <!-- SECTION: MEMORY -->
          <section id="memory" class="doc-section">
            <h2 class="section-title">Memory</h2>

            <div class="doc-intro">
              <p class="lead">Omni's memory system provides <strong>persistent context</strong> across sessions using Cloudflare KV namespaces. It stores facts, preferences, and system state to maintain continuity.</p>
            </div>

            <h3>Memory Architecture</h3>
            <div class="memory-diagram">
              <pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Memory System                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   MEMORY KV  â”‚    â”‚   MIND KV    â”‚ â”‚
â”‚  â”‚              â”‚    â”‚              â”‚ â”‚
â”‚  â”‚ â€¢ facts      â”‚    â”‚ â€¢ codex      â”‚ â”‚
â”‚  â”‚ â€¢ prefs      â”‚    â”‚ â€¢ state      â”‚ â”‚
â”‚  â”‚ â€¢ context    â”‚    â”‚ â€¢ patterns   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚         â”‚                    â”‚         â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                  â”‚                     â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚         â”‚  Session Layer  â”‚           â”‚
â”‚         â”‚  (Aggregation)  â”‚           â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                  â”‚                     â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚         â”‚  Omni Runtime   â”‚           â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              </pre>
            </div>

            <h3>Memory Types</h3>
            <div class="memory-types-grid">
              <div class="memory-type-card">
                <h4>ğŸ“ Facts</h4>
                <p>Explicit user information: name, preferences, project context</p>
                <div class="code-block">
                  <pre><code>{
  "user_name": "Alex",
  "timezone": "PST",
  "projects": ["website", "omni-mind-os"]
}</code></pre>
                </div>
              </div>

              <div class="memory-type-card">
                <h4>âš™ï¸ Preferences</h4>
                <p>Behavioral settings: verbosity, formality, response style</p>
                <div class="code-block">
                  <pre><code>{
  "response_length": "balanced",
  "code_style": "typescript",
  "tone": "professional"
}</code></pre>
                </div>
              </div>

              <div class="memory-type-card">
                <h4>ğŸ“š Codex</h4>
                <p>Learned patterns: common workflows, recurring themes</p>
                <div class="code-block">
                  <pre><code>{
  "workflows": {
    "debug": "check logs â†’ review code â†’ test"
  }
}</code></pre>
                </div>
              </div>
            </div>

            <h3>Memory Operations</h3>
            <div class="code-block">
              <strong>TypeScript API:</strong>
              <pre><code>// Write memory
await env.MEMORY.put("user:facts", JSON.stringify(facts));

// Read memory
const facts = await env.MEMORY.get("user:facts", "json");

// Delete memory
await env.MEMORY.delete("user:facts");

// List keys
const keys = await env.MEMORY.list({ prefix: "user:" });</code></pre>
            </div>

            <h3>Session Management</h3>
            <p>Client-side sessions are stored in <code>localStorage</code> under <code>omni-chat-history</code>:</p>
            <div class="code-block">
              <pre><code>{
  "messages": [
    { "role": "user", "content": "Hello", "timestamp": 1234567890 },
    { "role": "assistant", "content": "Hi there!", "timestamp": 1234567891 }
  ],
  "mode": "architect",
  "model": "omni"
}</code></pre>
            </div>

            <div class="info-box">
              <div class="info-icon">ğŸ’¡</div>
              <div>
                <strong>Privacy Note</strong>
                <p>All memory is scoped to your session. No data is shared across users. Use "Clear Chat History" in settings to wipe local storage.</p>
              </div>
            </div>
          </section>

          <!-- SECTION: API -->
          <section id="api" class="doc-section">
            <h2 class="section-title">API Reference</h2>

            <div class="doc-intro">
              <p class="lead">The Omni API provides <strong>streaming chat completions</strong> with mode selection, model routing, and memory integration. All endpoints use Server-Sent Events (SSE) for real-time token delivery.</p>
            </div>

            <h3>Base Endpoint</h3>
            <div class="endpoint-box">
              <span class="http-method">POST</span>
              <code>/api/omni/stream</code>
            </div>

            <h3>Request Format</h3>
            <div class="code-block">
              <strong>Headers:</strong>
              <pre><code>Content-Type: application/json
Accept: text/event-stream</code></pre>
            </div>

            <div class="code-block">
              <strong>Body:</strong>
              <pre><code>{
  "message": "Design a REST API for user authentication",
  "mode": "architect",       // optional: auto-detects if omitted
  "model": "omni",           // optional: defaults to "omni"
  "session": {               // optional: session context
    "history": [...],
    "user_id": "..."
  }
}</code></pre>
            </div>

            <h3>Response Format</h3>
            <p>Server-Sent Events stream with <code>data:</code> prefix:</p>
            <div class="code-block">
              <pre><code>data: Design
data:  a
data:  REST
data:  API
data:  with
data:  the
data:  following
data:  endpoints
data: ...
data: [DONE]</code></pre>
            </div>

            <h3>JavaScript Example</h3>
            <div class="code-block">
              <pre><code>async function streamOmniResponse(message, mode = "architect") {
  const response = await fetch("/api/omni/stream", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ message, mode })
  });

  const reader = response.body.getReader();
  const decoder = new TextDecoder();
  let buffer = "";

  while (true) {
    const { done, value } = await reader.read();
    if (done) break;

    buffer += decoder.decode(value, { stream: true });
    const lines = buffer.split("\n");
    buffer = lines.pop() || "";

    for (const line of lines) {
      if (line.startsWith("data: ")) {
        const token = line.slice(6);
        if (token === "[DONE]") return;
        console.log(token); // Append to UI
      }
    }
  }
}</code></pre>
            </div>

            <h3>Error Handling</h3>
            <div class="data-table">
              <table>
                <thead>
                  <tr>
                    <th>Status</th>
                    <th>Error</th>
                    <th>Solution</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td><code>400</code></td>
                    <td>Invalid request format</td>
                    <td>Check JSON structure</td>
                  </tr>
                  <tr>
                    <td><code>429</code></td>
                    <td>Rate limit exceeded</td>
                    <td>Wait and retry</td>
                  </tr>
                  <tr>
                    <td><code>500</code></td>
                    <td>Internal server error</td>
                    <td>Check worker logs</td>
                  </tr>
                  <tr>
                    <td><code>503</code></td>
                    <td>Model unavailable</td>
                    <td>Fallback model used</td>
                  </tr>
                </tbody>
              </table>
            </div>

            <h3>Model Options</h3>
            <div class="model-options-grid">
              <div class="model-option-card">
                <h4>omni</h4>
                <p><strong>Default choice</strong> â€” Multi-mode optimized model with emotional modulation</p>
                <span class="model-badge">Recommended</span>
              </div>
              <div class="model-option-card">
                <h4>gpt-4o-mini</h4>
                <p>Fast, cost-effective responses for simple queries</p>
                <span class="model-badge">Fast</span>
              </div>
              <div class="model-option-card">
                <h4>gpt-4o</h4>
                <p>Advanced reasoning for complex tasks</p>
                <span class="model-badge">Advanced</span>
              </div>
              <div class="model-option-card">
                <h4>deepseek</h4>
                <p>Alternative model with extended context</p>
                <span class="model-badge">Alt</span>
              </div>
            </div>

            <h3>Configuration</h3>
            <p>Environment variables in <code>wrangler.toml</code>:</p>
            <div class="code-block">
              <pre><code>[vars]
MODEL_OMNI = "@cf/meta/llama-3.1-8b-instruct"
MODEL_GPT_4O = "@cf/openai/gpt-4o"
MODEL_GPT_4O_MINI = "@cf/openai/gpt-4o-mini"
MODEL_DEEPSEEK = "@cf/deepseek/deepseek-r1"

OMNI_RESPONSE_MIN_CHARS = "1000"
OMNI_RESPONSE_BASE_CHARS = "10000"
OMNI_RESPONSE_MAX_CHARS = "50000"

OMNI_MIN_OUTPUT_TOKENS = "512"
OMNI_MAX_OUTPUT_TOKENS = "8192"</code></pre>
            </div>

            <div class="success-box">
              <div class="success-icon">âœ…</div>
              <div>
                <strong>Ready to Build?</strong>
                <p>Start integrating Omni into your applications. Check out the <a href="/chat.html">live chat interface</a> for examples.</p>
              </div>
            </div>
          </section>

        </article>
      </div>
    </main>
  </div>

  <script src="/scripts/docs.js"></script>
</body>
</html>
    navigating = true;

    body.classList.add("page-transition");

    const ms =
      parseFloat(getComputedStyle(body).getPropertyValue("--page-transition-ms")) || 350;

    window.setTimeout(() => {
      window.location.assign(url.href);
    }, ms);
  });
})();
</script>
</body>
</html>